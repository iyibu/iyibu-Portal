 var entityMap = {
    "&": "&amp;",
    "<": "&lt;",
    ">": "&gt;",
    '"': '&quot;',
    "'": '&#39;',
    "/": '&#x2F;',
	'\n' : '<br>'
  };

  function escapeHtml(string) {
    return String(string).replace(/[&<>"'\/]/g, function (s) {
      return entityMap[s];
    });
  }
  
jQuery.nl2br = function(varTest){
	return varTest.replace(/(\r\n|\n\r|\r|\n)/g, "<br>");
};

jQuery.br2nl = function(varTest){
	return varTest.replace(/<br>/g, "\r");
};
  
tinymce.PluginManager.add('kod', function(editor, url) {
    // Add a button that opens a window
    editor.addButton('kod', {
        icon: true,
		image: url+'/img/kod.png',
		tooltip: 'Web Kodu Ekle',
        onclick: function() {
            // Open window
            editor.windowManager.open({
                title: 'Web Kodu Ekle (Html, Css, Php, Asp, Javascript vs..)',
				body: [
                    {type: 'textbox', name: 'title', value: $.br2nl(editor.selection.getContent({format : 'text'})),
					multiline: true,
					style: 'width: 650px; height: 300px;'}
                ],
                onsubmit: function(e) {
                    // Insert content when the window form is submitted
                    editor.insertContent('<pre class="prettyprint linenums">' + $.nl2br(escapeHtml(e.data.title))+'</pre>');
                },
            });
        }
    });
tinymce.init({
    setup: function(editor) {
        editor.on('ObjectSelected', function(e) {
            console.log('ObjectSelected event', e);
        });
    }
});

});